import os
import sys

def sanitize_filename(filename):
    invalid_chars = {'/', '\\', ':', '*', '?', '<', '>', '|'}
    sanitized_name = ''.join(c if c not in invalid_chars else '_' for c in filename)
    return sanitized_name

def create_book(output_directory, book_filename):
    book_path = os.path.join(output_directory, book_filename)
    
    # Get the list of files and their creation times
    file_creation_times = []
    for file in os.listdir(output_directory):
        file_path = os.path.join(output_directory, file)
        if os.path.isfile(file_path) and file != book_filename:
            file_creation_time = os.path.getctime(file_path)
            file_creation_times.append((file, file_creation_time))

    # Sort the list of files by their creation times
    sorted_files = sorted(file_creation_times, key=lambda x: x[1])

    with open(book_path, "w") as book:
        for file, _ in sorted_files:
            file_path = os.path.join(output_directory, file)
            with open(file_path, "r") as chapter:
                lines = chapter.readlines()
                if len(lines) >= 2:
                    query = lines[0].replace("Query: ", "")
                    chatbot_response = lines[1].replace("Chatbot response: ", "")
                    book.write(query)
                    book.write(chatbot_response)
                    book.write("\n\n")
    print(f"Book created at '{book_path}'.")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python book_compiler.py <output_directory>")
    else:
        output_directory = sys.argv[1]
        create_book(output_directory, "book.txt")
